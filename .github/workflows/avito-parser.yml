name: Avito Book Parser

# –í–ê–ñ–ù–û: –î–í–ê –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–∞
on:
  # 1. –†–ê–°–ü–ò–°–ê–ù–ò–ï (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä)
  schedule:
    - cron: '2-59/5 * * * *'  # –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç, –ù–ï –≤ :00
  
  # 2. –†–£–ß–ù–û–ô –∑–∞–ø—É—Å–∫ (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä)  
  workflow_dispatch:

# –†–ê–ó–ù–´–ï JOBS –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
jobs:
  # JOB 1: –î–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–∞–≤—Ç–æ-–∑–∞–ø—É—Å–∫)
  scheduled-parse:
    # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
    if: github.event_name == 'schedule'
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    - run: pip install requests
    - name: –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–∏–≥
      env:
        TG_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TG_CHAT: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        echo "üîÑ –ê–í–¢–û–ó–ê–ü–£–°–ö –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é"
        echo "‚è∞ –í—Ä–µ–º—è: $(date)"
        python parser.py
  
  # JOB 2: –î–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞  
  manual-parse:
    # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –≤—Ä—É—á–Ω—É—é
    if: github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    - run: pip install requests
    - name: –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–∏–≥
      env:
        TG_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TG_CHAT: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        echo "üëÜ –†–£–ß–ù–û–ô –∑–∞–ø—É—Å–∫"
        echo "‚è∞ –í—Ä–µ–º—è: $(date)"
        python parser.py
